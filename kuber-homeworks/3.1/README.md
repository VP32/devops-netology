# Домашнее задание к занятию "Компоненты Kubernetes"


### Задание. Необходимо определить требуемые ресурсы

Известно, что проекту нужны база данных и система кеширования. Приложение состоит из бекенда и фронтенда.    
Опишите, какие ресурсы требуются при условии, что:   

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

**План расчёта**

1. Сделайте расчет всех необходимых ресурсов.
1. Спланируйте количество рабочих нод, которые справятся с такой нагрузкой. 
1. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды. 
1. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные. 
1. В результате должно быть указано количество нод и их параметры.


----

### Решение

_Для упрощения расчета принял, что 1 Гб = 1000 Мб. За счет этого результаты в гигабайтах буду округлять в большую сторону. 
Расчет выполняю для одного окружения. Если окружений будет несколько, полученные данные надо умножить на число окружений._

1. Общее количество ресурсов по видам нагрузки:
 - БД: 4 Гб, 1 ядро * 3 копии = 12 Гб, 3 ядра
 - Кэш: 4 Гб, 1 ядро * 3 = 12 Гб, 3 ядра
 - Фронт: 50 Мб, 0.2 ядра * 5 = 0,25 Гб, 1 ядро
 - Бэк: 600 Мб, 1 ядро * 10 = 6 Гб, 10 ядер

2. Распределяю по нодам требуемые ресурсы:
 - **БД:** Поскольку БД требуется отказоустойчивая, то под БД выделяю отдельные 3 ноды (по числу копий), на которых ничего больше не будет размещаться, чтобы минимизировать простой и ошибки при выходе из строя ноды.

     **Получаю 3 ноды, на каждой по 1 ядру и 4 Гб ОЗУ.**
 - **Кэш:** Аналогично БД, для отказоустойчивости выделяю по ноде на копию.
    
    **Получаю 3 ноды, на каждой по 1 ядру и 4 Гб ОЗУ.**
 - **Бэк и фронт:** Поскольку требований к отказоустойчивости не было, считаю возможным размещать на одной ноде несколько копий, и для некоторой экономии считаю возможным размещать и бэк, и фронт на одной и той же ноде. Наиболее ресурсоемким получается бэк. Требуемые ресурсы для бэка делю на 5 нод (удобно делится по числу ядер на 10, 5 или 2, беру 5).

    Для бэка получаю 5 нод, на которых предполагается по 2 копии бэка. По ресурсам это 2 ядра и 1,2 ГБ на ноду.
    
    К 2 копиям бэка на одну и ту же ноду "подселяю" по одной копии фронта. Соответственно к ресурсам добавляются 0,2 ядра и 0,05 Гб ОЗУ.
    
    **Итого для бэка и фронта: 5 нод по 2,2 ядра и 1,25 Гб ОЗУ.**

3. Резервирую в каждой из групп нод запас для выхода из строя одной ноды:

- **БД** На каждую ноду 1 + 1 ядро, 4 Гб + 4 ГБ = **2 ядра, 8 ГБ ОЗУ * 3 ноды.**
- **Кэш** На каждую ноду 1 + 1 ядро, 4 Гб + 4 ГБ = **2 ядра, 8 ГБ ОЗУ * 3 ноды.**
- **Бэк и фронт** На каждую ноду 2,2 + 2,2 ядра, 1,25 Гб + 1,25 Гб = **4,4 ядра, 2,5 Гб ОЗУ * 5 нод.** 

4. Добавляю к каждой ноде служебные ресурсы. Это мой первый расчет кластера, опыта у меня нет, поэтому умозрительно предполагаю, что на служебные ресурсы, такие как kubelet, kube-proxy, возможные агенты для логирования и мониторинга и прочее можно заложить 10% ресурсов на ноде или не менее 0,1 ядра и 0,1 Гб ОЗУ. 
Из этих предположений получаю:

- **БД** На каждую ноду 2 + 0,2 ядра, 8 Гб + 0,8 ГБ = **2,2 ядра, ~9 ГБ ОЗУ * 3 ноды**
- **Кэш** На каждую ноду 2 + 0,2 ядра, 8 Гб + 0,8 ГБ = **2,2 ядра, ~9 ГБ ОЗУ * 3 ноды**
- **Бэк и фронт** На каждую ноду 4,4 + 0,44 ядра, 2,5 Гб + 0,25 ГБ = **~5 ядер, 2,75 Гб ОЗУ * 5 нод**

- **Итого: 11 нод, 38.2 ядра, 67.75 Гб ОЗУ**

Эти данные можно считать итоговым числом и конфигурацией нод на одно окружение. Если окружений несколько, то полученный результат умножить на число окружений.

Это был расчет воркер-нод. Также к этим данным добавляются мастер-ноды. Считаю, что надо использовать как минимум 3 мастер-ноды для обеспечения отказоустойчивости управления кластером. Конфигурацию мастер-нод дать затрудняюсь, слишком мало опыта. Число мастер-нод при небольшом количестве окружений не требуется увеличивать.