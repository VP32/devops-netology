# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

Команда в Linux:

ip -c -br link

также можно использовать: netstat -i

пример:
```bash
vladimir@linuxstage:~$ ip -c -br link
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP> 
wlp0s20f3        UP             28:11:a8:de:75:01 <BROADCAST,MULTICAST,UP,LOWER_UP> 
```

В Windows можно использовать команду ipconfig

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

Для этого используется протокол LLDP. Для работы с ним нужно установить пакет lldpd и запустить его демона:

```bash
apt install lldpd
systemctl enable lldpd && systemctl start lldpd
```

Команда lldpctl покажет соседнее устройство, также позволяет определить, к какому порту коммутатора подключен сервер.

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

Для этого используется технология VLAN. В Linux для этого используется пакет vlan. Настройка vlan производится с помощью утилиты vconfig (объявлена deprecated), либо с помощью утилиты ip. Чтобы сохранить конфигурацию VLAN и использовать ее после перезагрузки, необходимо записать конфиг в файл /etc/network/interfaces. Например:

```
auto vlan1400
iface vlan1400 inet static
        address 192.168.1.1
        netmask 255.255.255.0
        vlan_raw_device eth0
```

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

Типы агрегации:
#### mode=0 (balance-rr)

Этот режим используется по-умолчанию, если в настройках не указано другое. balance-rr обеспечивает балансировку нагрузки и отказоустойчивость. В данном режиме пакеты отправляются "по кругу" от первого интерфейса к последнему и сначала. Если выходит из строя один из интерфейсов, пакеты отправляются на остальные оставшиеся. При подключении портов к разным коммутаторам, требует их настройки.
#### mode=1 (active-backup)

При active-backup один интерфейс работает в активном режиме, остальные в ожидающем. Если активный падает, управление передается одному из ожидающих. Не требует поддержки данной функциональности от коммутатора.
#### mode=2 (balance-xor)

Передача пакетов распределяется между объединенными интерфейсами по формуле ((MAC-адрес источника) XOR (MAC-адрес получателя)) % число интерфейсов. Один и тот же интерфейс работает с определённым получателем. Режим даёт балансировку нагрузки и отказоустойчивость.
#### mode=3 (broadcast)

Происходит передача во все объединенные интерфейсы, обеспечивая отказоустойчивость.
#### mode=4 (802.3ad)

Это динамическое объединение портов. В данном режиме можно получить значительное увеличение пропускной способности как входящего так и исходящего трафика, используя все объединенные интерфейсы. Требует поддержки режима от коммутатора, а так же (иногда) дополнительную настройку коммутатора.
#### mode=5 (balance-tlb)

Адаптивная балансировка нагрузки. При balance-tlb входящий трафик получается только активным интерфейсом, исходящий - распределяется в зависимости от текущей загрузки каждого интерфейса. Обеспечивается отказоустойчивость и распределение нагрузки исходящего трафика. Не требует специальной поддержки коммутатора.
#### mode=6 (balance-alb)

Адаптивная балансировка нагрузки (более совершенная). Обеспечивает балансировку нагрузки как исходящего (TLB, transmit load balancing), так и входящего трафика (для IPv4 через ARP). Не требует специальной поддержки коммутатором, но требует возможности изменять MAC-адрес устройства.

Для работы нужно установить пакет ifenslave и включить модуль ядра:

```bash
apt install ifenslave
modprobe bonding
```

Для постоянной агрегации, сохраняемой после перезагрузки системы, нужно внести изменения в сетевой конфиг /etc/network/interfaces. Пример такого конфига (в системе есть 2 сетевых интерфейса enp0s3 и enp0s8):

```
auto enp0s3
iface enp0s3 inet manual
auto enp0s8
iface enp0s8 inet manual
iface bond0 inet static
    address 192.168.1.150
    netmask 255.255.255.0
    gateway 192.168.1.1
    dns-nameservers 192.168.1.1 8.8.8.8
    dns-search domain.local
    slaves enp0s3 enp0s8
    bond_mode balance-rr
    bond-miimon 100
    bond_downdelay 0
    bond_updalay 0
```



5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

Сколько IP адресов в сети с маской /29 ?  6 доступных для хостов + служебные нулевой и широковещательный, итого 8

```bash
vladimir@linuxstage:~$ ipcalc 10.10.10.0/29
Address:   10.10.10.0           00001010.00001010.00001010.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet
```

Сколько /29 подсетей можно получить из сети с маской /24? 32 подсети.

Проверим, сколько в /24 подсети доступно ip-адресов:

```bash
vladimir@linuxstage:~$ ipcalc 10.10.10.0/24
Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet
```

В сети /24 можем использовать 254 + 2 служебных = 256 адресов. В сети /29 доступно 8 адресов. 256/8 = 32 подсети

Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

Например, 10.10.10.0/29, 10.10.10.8/29, 10.10.10.16/29:
```bash
vladimir@linuxstage:~$ ipcalc 10.10.10.0/29
Address:   10.10.10.0           00001010.00001010.00001010.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

vladimir@linuxstage:~$ ipcalc 10.10.10.8/29
Address:   10.10.10.8           00001010.00001010.00001010.00001 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.8/29        00001010.00001010.00001010.00001 000
HostMin:   10.10.10.9           00001010.00001010.00001010.00001 001
HostMax:   10.10.10.14          00001010.00001010.00001010.00001 110
Broadcast: 10.10.10.15          00001010.00001010.00001010.00001 111
Hosts/Net: 6                     Class A, Private Internet

vladimir@linuxstage:~$ ipcalc 10.10.10.16/29
Address:   10.10.10.16          00001010.00001010.00001010.00010 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.16/29       00001010.00001010.00001010.00010 000
HostMin:   10.10.10.17          00001010.00001010.00001010.00010 001
HostMax:   10.10.10.22          00001010.00001010.00001010.00010 110
Broadcast: 10.10.10.23          00001010.00001010.00001010.00010 111
Hosts/Net: 6                     Class A, Private Internet
```


6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

Можно использовать сеть из диапазона адресов Carrier-Grade NAT. Адреса начинаются с 100.64.0.0. Маска /10 для нас слишком велика, в ней доступно 4194302 хостов. Можно использовать подсеть /26, в ней доступно 62 хоста. В подсети /27 доступно уже 30 хостов, что нам не подходит. 

Итого, используем подсеть 100.64.0.0/26:

```bash
vladimir@linuxstage:~$ ipcalc 100.64.0.0/10
Address:   100.64.0.0           01100100.01 000000.00000000.00000000
Netmask:   255.192.0.0 = 10     11111111.11 000000.00000000.00000000
Wildcard:  0.63.255.255         00000000.00 111111.11111111.11111111
=>
Network:   100.64.0.0/10        01100100.01 000000.00000000.00000000
HostMin:   100.64.0.1           01100100.01 000000.00000000.00000001
HostMax:   100.127.255.254      01100100.01 111111.11111111.11111110
Broadcast: 100.127.255.255      01100100.01 111111.11111111.11111111
Hosts/Net: 4194302               Class A

vladimir@linuxstage:~$ ipcalc 100.64.0.0/27
Address:   100.64.0.0           01100100.01000000.00000000.000 00000
Netmask:   255.255.255.224 = 27 11111111.11111111.11111111.111 00000
Wildcard:  0.0.0.31             00000000.00000000.00000000.000 11111
=>
Network:   100.64.0.0/27        01100100.01000000.00000000.000 00000
HostMin:   100.64.0.1           01100100.01000000.00000000.000 00001
HostMax:   100.64.0.30          01100100.01000000.00000000.000 11110
Broadcast: 100.64.0.31          01100100.01000000.00000000.000 11111
Hosts/Net: 30                    Class A

vladimir@linuxstage:~$ ipcalc 100.64.0.0/26
Address:   100.64.0.0           01100100.01000000.00000000.00 000000
Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
=>
Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
Hosts/Net: 62                    Class A
```


7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

**В Linux:**

Как проверить ARP таблицу? командами arp -a или ip neigh
```bash
vladimir@linuxstage:~$ arp -a
? (192.168.1.140) в a8:a1:59:48:0e:e3 [ether] на wlp0s20f3
_gateway (192.168.1.1) в 50:ff:20:50:7f:0a [ether] на wlp0s20f3
vladimir@linuxstage:~$ ip neigh
192.168.1.140 dev wlp0s20f3 lladdr a8:a1:59:48:0e:e3 STALE
192.168.1.1 dev wlp0s20f3 lladdr 50:ff:20:50:7f:0a REACHABLE
```

Как очистить ARP кеш полностью? 
sudo ip neigh flush all

Как из ARP таблицы удалить только один нужный IP? 
sudo arp -d <ip узла>

**В Windows:**

Как проверить ARP таблицу? командой arp -a 

Как очистить ARP кеш полностью? командой netsh interface ip delete arpcache

Как из ARP таблицы удалить только один нужный IP? командой arp -d <ip узла>